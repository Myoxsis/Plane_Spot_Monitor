'use client';import { useState } from 'react';export default function UploadPage(){const [file,setFile]=useState<File|null>(null);const [result,setResult]=useState<any>(null);const [loading,setLoading]=useState(false);const [error,setError]=useState<string|null>(null);const onSubmit=async(e:React.FormEvent)=>{e.preventDefault();if(!file) return;setLoading(true);setError(null);setResult(null);const fd=new FormData();fd.append('file',file);const res=await fetch('/api/import/csv',{method:'POST',body:fd});if(!res.ok){setError(await res.text());setLoading(false);return}setResult(await res.json());setLoading(false)};return(<div className='space-y-4'><h1 className='text-xl font-semibold'>CSV Import</h1><form onSubmit={onSubmit} className='space-y-3'><input type='file' accept='.csv,text/csv' onChange={e=>setFile(e.target.files?.[0]||null)} /><button className='btn' disabled={!file||loading}>{loading?'Uploading…':'Upload & Process'}</button></form>{error&&<div className='text-red-600'>{error}</div>}{result&&(<div className='text-sm space-y-2'><div>Processed: <b>{result.processed}</b>, Inserted: <b>{result.inserted}</b>, Updated: <b>{result.updated}</b>, Flagged (score ≥ 20): <b>{result.flagged}</b></div>{result.diagnostics&&(<div><div className='font-semibold'>Diagnostics</div><ul className='list-disc pl-6'>{Object.entries(result.diagnostics).map(([k,v]:any)=>(<li key={k}><code className='kbd'>{k}</code>: {v as any}</li>))}</ul></div>)}{result.samples?.length?(<div className='mt-3'><div className='font-semibold'>Sample flagged:</div><ul className='list-disc pl-6'>{result.samples.map((s:any)=>(<li key={s.id}>{s.registration} {s.modelCode} {s.modelText} — {s.score?.label} ({s.score?.score})</li>))}</ul></div>):null}</div>)}</div>) }
